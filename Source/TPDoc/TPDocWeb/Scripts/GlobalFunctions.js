
$(".getLinkToThisPage").click(function () {
    $(".displayLinkToThisPage").html("<strong>Link: </strong>" + htmlEncode($("#hiddenLinkText").text()));
});

function htmlEncode(html) {
    return document.createElement('a').appendChild(
        document.createTextNode(html)).parentNode.innerHTML;
};

String.prototype.escapeSpecialChars = function () {
    return this.replace(/[\\]/g, '\\\\')
    .replace(/[\"]/g, '\\\"')
    .replace(/[\/]/g, '\\/')
    .replace(/[\b]/g, '\\b')
    .replace(/[\f]/g, '\\f')
    .replace(/[\n]/g, '\\n')
    .replace(/[\r]/g, '\\r')
    .replace(/[\t]/g, '\\t');
};

//Makes all external links open in new tab
$(".manualContent a").click(function ()
{
    var url = $(this).attr('href');
    if(isExternal(url))
    {
        var win = window.open(url, '_blank');
        win.focus();
        return false;
    }
    return true;    
});

//Determines if an url is from this domain
var checkDomain = function (url) {
    if (url.indexOf('//') === 0) { url = location.protocol + url; }
    return url.toLowerCase().replace(/([a-z])?:\/\//, '$1').split('/')[0];
};

//Determines if an url is external
var isExternal = function (url)
{
    return ((url.indexOf(':') > -1 || url.indexOf('//') > -1) && checkDomain(location.href) !== checkDomain(url));
};


function newPage()
{
    var x;
    var pageName = prompt("Enter the name for new site", "level1/level2/levelN/siteName");
    if (pageName != null && pageName != "")
    {
        window.location.href = "/Wiki/Page/Manual£" + sanitize(pageName);
    }
}

function sanitize(str)
{
    var str1 = str.replace(/[^0-9a-zA-Z\/\._ ]+/g, "");
    return str1.replace(/\//g, "£").replace(/\./g, "€").replace(/ /g, "_");
}

function deSanitize(str)
{
    return str.replace(/£/g, "/").replace(/€/g, ".").replace(/_/g, " ");
}

$(document).ready(function ()
{
    if ($('.pageNavDiv').text().length < 30)
    {
        $('.pageNavDiv').css("display", "none");
    }
});

//Expand the menu for manual or autogenerated pages
$(document).ready(function ()
{
    if ($(window).width() > 1480) {
        if (decodeURIComponent(window.location.pathname).toLowerCase().indexOf("/wiki/page/integration") == 0)
        {
            $("#biztalkHeader").next().show();
        }
        else if (decodeURIComponent(window.location.pathname).toLowerCase().indexOf("/wiki/page/map") == 0)
        {
            $("#biztalkHeader").next().show();
        }
        else if (decodeURIComponent(window.location.pathname).toLowerCase().indexOf("/wiki/page/orchestrations") == 0)
        {
            $("#biztalkHeader").next().show();
        }
        else if (decodeURIComponent(window.location.pathname).toLowerCase().indexOf("/wiki/page/pipelines") == 0)
        {
            $("#biztalkHeader").next().show();
        }
        else if (decodeURIComponent(window.location.pathname).toLowerCase().indexOf("/wiki/page/sendports") == 0)
        {
            $("#biztalkHeader").next().show();
        }
        else if (decodeURIComponent(window.location.pathname).toLowerCase().indexOf("/wiki/page/recieveports") == 0)
        {
            $("#biztalkHeader").next().show();
        }
        else if (decodeURIComponent(window.location.pathname).toLowerCase().indexOf("/wiki/page/manual£project") == 0)
        {
            $("#projectHeader").next().show();
        }
        else if (decodeURIComponent(window.location.pathname).toLowerCase().indexOf("/wiki/page/manual£projects") == 0)
        {
            $("#projectHeader").next().show();
        }
        else if (decodeURIComponent(window.location.pathname).toLowerCase().indexOf("/wiki/page/manual£external") == 0)
        {
            $("#externalHeader").next().show();
        }
        else if (decodeURIComponent(window.location.pathname).toLowerCase().indexOf("/wiki/page/manual£external services") == 0)
        {
            $("#externalHeader").next().show();
        }
        else if (decodeURIComponent(window.location.pathname).toLowerCase().indexOf("/wiki/page/manual£service") == 0)
        {
            $("#servicesHeader").next().show();
        }
        else if (decodeURIComponent(window.location.pathname).toLowerCase().indexOf("/wiki/page/manual£services") == 0)
        {
            $("#servicesHeader").next().show();
        }
        else if (decodeURIComponent(window.location.pathname).toLowerCase().indexOf("/wiki/page/manual£architecture") == 0)
        {
            $("#MDMFrameworkHeader").next().show();
        }
        else if (decodeURIComponent(window.location.pathname).toLowerCase().indexOf("/wiki/page/manual£business_services") == 0) {
            $("#businessServicesHeader").next().show();
        }
        else if (decodeURIComponent(window.location.pathname).toLowerCase().indexOf("/wiki/page/manual£organization") == 0) {
            $("#organizationHeader").next().show();
        }
        else if (decodeURIComponent(window.location.pathname).toLowerCase().indexOf("/wiki/page/manual£routines") == 0) {
            $("#buildNDeployHeader").next().show();
        }
        else if (decodeURIComponent(window.location.pathname).toLowerCase().indexOf("/wiki/page/manual£support") == 0) {
            $("#supportHeader").next().show();
        }
        else if (decodeURIComponent(window.location.pathname).toLowerCase().indexOf("/wiki/page/manual£resources") == 0) {
            $("#resourcesHeader").next().show();
        }
        else if (decodeURIComponent(window.location.pathname).toLowerCase().indexOf("/wiki/page/manual£logic_apps") == 0) {
            $("#logicAppHeader").next().show();
        }
        else if (decodeURIComponent(window.location.pathname).toLowerCase().indexOf("/wiki/page/manual£data_factory") == 0) {
            $("#factoryHeader").next().show();
        }
        else if (decodeURIComponent(window.location.pathname).toLowerCase().indexOf("/wiki/page/manual£cloud_databases") == 0) {
            $("#cloudDatabaseHeader").next().show();
        }
        else if (decodeURIComponent(window.location.pathname).toLowerCase().indexOf("/wiki/page/manual£data_factory") == 0) {
            $("#factoryHeader").next().show();
        }
        else if (decodeURIComponent(window.location.pathname).toLowerCase().indexOf("/wiki/page/webjob") == 0) {
            $("#webjobsHeader").next().show();
        }
        else if (decodeURIComponent(window.location.pathname).toLowerCase().indexOf("/wiki/page/api£") == 0) {
            $("#apiHeader").next().show();
        }
        else if (decodeURIComponent(window.location.pathname).toLowerCase().indexOf("/wiki/page/api_management") == 0) {
            $("#ApiManagementHeader").next().show();
        }
    }

});

$(".mainHeader").click(function(event)
{
    $("#" + (event.target).id).next().slideToggle("fast");
    return false;
});

$(".pageNav li").click(function (event)
{
    var text = $("#" + (event.target).id).text();
    var foundin = $('h3:contains("' + text + '"),h4:contains("' + text + '")');

    $("html, body").scrollTop($(foundin).offset().top);

});

$(".smallEditText").click(function (event)
{
    $(".markItUpContainer").slideToggle("fast");
});

$(document).ajaxStart(function () {
    $('body').addClass('wait');

}).ajaxComplete(function () {

    $('body').removeClass('wait');

});



